(function(){var e,t,n,r,a,i,s,o,u,d,p,c,f,l,b,m,g,h,S,v;e={tvdbApiKey:""},c=require("http"),n=require("express"),t=n(),b=function(t,n){var r;return r={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/actors.xml",type:"actors"},f(r,function(e){n(e)})},m=function(t,n){var r;return r={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/banners.xml",type:"banners"},f(r,function(e){var t;try{JSON.parse(e).Banners.Banner[0].id}catch(r){t=r,e=JSON.stringify({Banners:{Banner:[]}})}n(e)})},h=function(t,n){var r;return r={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/all/en.xml",type:"seriesById"},f(r,function(e){n(e)})},s=function(e){var t,n,r,a,i;if(n=[],e=JSON.parse(e),e&&e.Data&&e.Data.Series)for(i=e.Data.Series,r=0,a=i.length;a>r;r++)t=i[r],n.push({id:""+t.seriesid,name:""+t.SeriesName,language:""+t.language,banner:t.banner?"http://thetvdb.com/banners/"+t.banner:"",overview:""+t.Overview,firstAired:""+t.FirstAired,network:""+t.Network,imdbId:""+t.IMDB_ID,zap2itId:""+t.zap2it_id});return JSON.stringify(n)},v=function(t,n){var r;return r={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/all/en.xml",type:"seriesById"},f(r,function(e){var t;t={seriesData:JSON.parse(e)},n(JSON.stringify(t))})},S=function(e,t,n){var r,a,i;return i="",r=0,"Name"===e?(i={url:"http://thetvdb.com/api/GetSeries.php?seriesname="+t,type:"seriesByName"},void f(i,function(e){var t;try{JSON.parse(e).Data.Series[0]}catch(r){t=r,e=JSON.stringify({Data:{Series:[]}})}return n(e)})):void("Id"===e&&(a={seriesData:"",actorsData:"",bannersData:""},function(e,t,n,r){p(r,function(r){t.seriesData=JSON.parse(r),e++,3===e&&n(JSON.stringify(t,null,4))},function(r){t.actorsData=JSON.parse(r),e++,3===e&&n(JSON.stringify(t,null,4))},function(r){t.bannersData=JSON.parse(r),e++,3===e&&n(JSON.stringify(t,null,4))})}(r,a,n,t)))},p=function(t,n,r,a){var i;i={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/all/en.xml",type:"seriesById"},f(i,function(e){n(e)}),i={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/actors.xml",type:"actors"},f(i,function(e){r(e)}),i={url:"http://thetvdb.com/api/"+e.tvdbApiKey+"/series/"+t+"/banners.xml",type:"banners"},f(i,function(e){a(e)})},f=function(e,t){var n;n=c.get(e.url,function(e){var n;n="",function(n){e.on("data",function(e){n+=e}),e.on("end",function(e){n+=e,l(n,t)})}(n)}).on("error",function(e){t(JSON.stringify("",null,4))}),n.end()},l=function(e,t){var n;(n=require("xml2js").parseString)(e,function(e,n){e&&(n=""),t(JSON.stringify(n,null,4))})},d=function(e){var t,n,i,s,o,d,p,c,f;if(o=JSON.parse(u(e)),e=JSON.parse(e),e.actorsData&&e.actorsData.Actors)for(n=e.actorsData.Actors.Actor,d=0,c=n.length;c>d;d++)t=n[d],o.actorsDetails.push(JSON.parse(r(JSON.stringify(t))));if(e.bannersData&&e.bannersData.Banners)for(s=e.bannersData.Banners.Banner,p=0,f=s.length;f>p;p++)i=s[p],o.banners.push(JSON.parse(a(JSON.stringify(i))));return JSON.stringify(o,null,4)},o=function(e){},a=function(e){return e=JSON.parse(e),JSON.stringify({id:""+e.id,url:e.BannerPath?"http://thetvdb.com/banners/"+e.BannerPath:"",type:""+e.BannerType,resolution:""+e.BannerType2,colors:""+e.Colors,language:""+e.Language,rating:""+e.Rating,ratingCount:""+e.RatingCount,seriesName:""+e.SeriesName,thumbnailUrl:e.ThumbnailPath?"http://thetvdb.com/banners/"+e.ThumbnailPath:"",vignetteUrl:e.VignettePath?"http://thetvdb.com/banners/"+e.VignettePath:""})},r=function(e){return e=JSON.parse(e),JSON.stringify({id:""+e.id,name:""+e.Name,role:""+e.Role,sortOrder:""+e.SortOrder,imageUrl:e.Image?"http://thetvdb.com/banners/"+e.Image:""})},i=function(e){return e=JSON.parse(e),JSON.stringify({id:""+e.id,name:""+e.EpisodeName,number:""+e.EpisodeNumber,language:""+e.Language,airDate:""+e.FirstAired,guestStars:""+e.GuestStars,imdbId:""+e.IMDB_ID,director:""+e.Director,combinedEpisodeNumber:""+e.Combined_episodenumber,combinedSeason:""+e.Combined_season,dvdChapter:""+e.DVD_chapter,dvdDiscId:""+e.DVD_discid,dvdEpisodeNumber:""+e.DVD_episodenumber,dvdSeason:""+e.DVD_season,epImgFlag:""+e.EpImgFlag,overview:""+e.Overview,productionCode:""+e.ProductionCode,rating:""+e.Rating,ratingCount:""+e.RatingCount,season:""+e.SeasonNumber,writer:""+e.Writer,absoluteNumber:""+e.absolute_number,airsAfterSeason:""+e.airsafter_season,airsBeforeSeason:""+e.airsbefore_season,airsBeforeEpisode:""+e.airsbefore_episode,thumbnailUrl:e.filename?"http://thetvdb.com/banners/"+e.filename:"",lastUpdated:""+e.lastupdated,seasonId:""+e.seasonid,seriesId:""+e.seriesid,thumbnailAdded:""+e.thumb_added,thumbnailResultion:""+e.thumb_height+"x"+e.thumb_height})},c.createServer(function(e,t){!function(e){requestSeries(function(t){e.end(t)})}(t)}).listen(1337,"127.0.0.1"),u=function(e){var t,n,r,a,s,o,u,d;if(s={seasons:[],actorsDetails:[],banners:[]},e=JSON.parse(e),e.seriesData&&e.seriesData.Data&&(e.seriesData.Data.Series&&e.seriesData.Data.Series[0]&&(o=e.seriesData.Data.Series[0],s={id:""+o.id,actors:""+o.Actors,airsOnDayOfWeek:""+o.Airs_DayOfWeek,airsAtTime:""+o.Airs_Time,contentRating:""+o.ContentRating,firstAired:""+o.FirstAired,genre:""+o.Genre,imdbId:""+o.IMDB_ID,language:""+o.Language,network:""+o.Network,networkId:""+o.NetworkID,overview:""+o.Overview,rating:""+o.Rating,ratingCount:""+o.RatingCount,runtime:""+o.Runtime,name:""+o.SeriesName,runningStatus:""+o.Status,added:""+o.added,addedBy:""+o.addedBy,bannerUrl:o.banner?"http://thetvdb.com/banners/"+o.banner:"",fanartUrl:o.fanart?"http://thetvdb.com/banners/"+o.fanart:"",lastUpdated:""+o.lastupdated,poster:o.poster?"http://thetvdb.com/banners/"+o.poster:"",zap2itId:""+o.zap2it_id,seasons:[],actorsDetails:[],banners:[]}),e.seriesData.Data.Episode)){for(r=e.seriesData.Data.Episode,n=[],a=+r[0].SeasonNumber,u=0,d=r.length;d>u;u++)t=r[u],+t.SeasonNumber!==a&&(s.seasons.push({number:""+a,episodes:n}),a++,n=[]),n.push(JSON.parse(i(JSON.stringify(t))));s.seasons.push({number:""+a,episodes:n})}return JSON.stringify(s,null,4)},exports.setTvdbApiKey=function(t){return e.tvdbApiKey=t},exports.getSeriesByName=function(e,t){e=encodeURIComponent(e),S("Name",e,function(e){var n;n={seriesArray:JSON.parse(s(e))},t(JSON.stringify(n,null,4))})},exports.getSeriesOnlyById=function(e,t){e=encodeURIComponent(e),v(e,function(e){t(u(e))})},exports.getSeriesPlusActorsPlusBannersById=function(e,t){e=encodeURIComponent(e),S("Id",e,function(e){t(d(e))})},exports.getActorsForSeriesWithId=function(e,t){e=encodeURIComponent(e),b(e,function(e){var n,a,i,s,o;if(e=JSON.parse(e),a=[],e.Actors&&e.Actors.Actor)for(o=e.Actors.Actor,i=0,s=o.length;s>i;i++)n=o[i],a.push(JSON.parse(r(JSON.stringify(n))));t(JSON.stringify(a,null,4))})},exports.getBannersForSeriesWithId=function(e,t){e=encodeURIComponent(e),m(e,function(e){var n,r,i,s,o;if(e=JSON.parse(e),r=[],e.Banners&&e.Banners.Banner)for(o=e.Banners.Banner,i=0,s=o.length;s>i;i++)n=o[i],r.push(JSON.parse(a(JSON.stringify(n))));t(JSON.stringify(r,null,4))})},exports.getEpisodeAiredOnDateForSeriesWithId=function(e,t,n){g(e,t,function(e){var t;return e=JSON.parse(e),t=e.Data&&e.Data.Episode?e.Data.Episode:"",n(i(JSON.stringify(t)))})},g=function(t,n,r){var a;return a={url:"http://thetvdb.com/api/GetEpisodeByAirDate.php?apikey="+e.tvdbApiKey+"&seriesid="+n+"&airdate="+t,type:""},f(a,function(e){r(e)})}}).call(this);
//# sourceMappingURL=./index.js.map